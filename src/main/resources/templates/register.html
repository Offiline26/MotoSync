<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/_head :: head('Cadastro')}"></head>
<body>

<main class="container" th:with="isEdit=${false}">
    <div class="header">
        <h1>Cadastro</h1>
        <a class="btn" th:href="@{/login}">Voltar ao login</a>
    </div>

    <div th:if="${error}" class="alert danger" th:text="${error}"></div>

    <!-- POST /register cadastra -->
    <form th:action="@{/register}" method="post" th:object="${form}">
        <input type="hidden" th:if="${_csrf != null}"
               th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

        <label>E-mail
            <input type="email" th:field="*{email}" required/>
        </label>
        <div class="alert danger" th:if="${#fields.hasErrors('email')}" th:errors="*{email}"></div>

        <label>Senha
            <input type="password" th:field="*{password}" minlength="6" required/>
        </label>
        <div class="alert danger" th:if="${#fields.hasErrors('password')}" th:errors="*{password}"></div>

        <label>Cargo
            <select th:field="*{cargo}" required>
                <option value="" disabled selected>—</option>
                <option th:value="OPERADOR_PATIO">Operador de Pátio</option>
                <option th:value="ADMIN">Admin</option>
            </select>
        </label>
        <div class="alert danger" th:if="${#fields.hasErrors('cargo')}" th:errors="*{cargo}"></div>

        <!-- adicione depois do campo Cargo -->
        <label id="grp-patio" style="display:none">
            Pátio em que atua
            <select th:field="*{patioId}" id="patioId">
                <option value="" disabled selected>—</option>
                <option th:each="p : ${patios}"
                        th:value="${p.id}"
                        th:text="${p.nome}"></option>
            </select>
        </label>
        <div class="alert danger" th:if="${#fields.hasErrors('patioId')}" th:errors="*{patioId}"></div>

    </form>

    <script>
        (function(){
            const cargo = document.querySelector('select[name="cargo"]');
            const grp   = document.getElementById('grp-patio');
            const patio = document.getElementById('patioId');

            function togglePatio(){
                const show = cargo && cargo.value === 'OPERADOR_PATIO';
                grp.style.display = show ? '' : 'none';
                patio.required = show;
                patio.disabled = !show; // se desabilitado, o navegador não envia o campo
                if (!show) patio.value = '';
            }
            cargo && cargo.addEventListener('change', togglePatio);
            togglePatio();
        })();
    </script>

        <div class="actions">
            <button class="btn btn-primary" type="submit">Cadastrar</button>
        </div>
    </form>
</main>
</body>
</html>